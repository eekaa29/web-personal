{% extends "core/base.html" %}
{% load static %}
{% block title %}Contenido Gratuito{% endblock %}

{% block content %}
<section class="mx-auto max-w-7xl px-6 lg:px-8 py-10">
  <h1 class="mt-12 p-4 font-title uppercase text-4xl text-stone-800 bold tracking-[-0.06em] flex justify-end font-bold">Workflows N8N</h1>

  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for w in workflows %}
      <article class="group rounded-2xl border border-slate-200 bg-white p-5 shadow-sm hover:shadow-md transition">
        <h2 class="text-lg font-semibold text-slate-900">{{ w.title }}</h2>
        <p class="mt-2 text-sm text-slate-600">{{ w.desc }}</p>

        <div class="mt-4 flex gap-2">
          <!-- Descarga local desde /static -->
          <a href="{% static 'core/workflows/lead_form_copy.json' %}"
             download
             class="inline-flex items-center rounded-lg px-3 py-2 text-sm font-medium text-white bg-slate-900 hover:bg-slate-800">
            Descargar JSON
          </a>

          {% if w.github_raw %}
            <!-- Copiar URL para 'Import from URL' en n8n -->
            <button type="button"
                    data-url="{{ w.github_raw }}"
                    class="copy-url inline-flex items-center rounded-lg px-3 py-2 text-sm font-medium ring-1 ring-slate-300 hover:bg-slate-50">
              Copiar URL de importación
            </button>
          {% endif %}
        </div>

        <p class="mt-3 text-xs text-slate-500">
          Importar en n8n: Workflows → ⋯ → <em>Import from File</em> (o <em>Import from URL</em>) → Asignar credenciales → Activate.
        </p>
      </article>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('.copy-url');
    if (!btn) return;
    navigator.clipboard.writeText(btn.dataset.url).then(() => {
      btn.textContent = 'Copiado ✓';
      setTimeout(() => btn.textContent = 'Copiar URL de importación', 1500);
    });
  });
</script>
{% endblock %}
