{% extends 'core/base.html' %}
{% load static %}
{% block title %}Contact{% endblock %}
{% block content %}
    <h1 class="mt-12 p-4 font-title uppercase text-4xl text-stone-800 bold tracking-[-0.06em] flex justify-end font-bold">Trabajemos Juntos</h1>
    <div class="m-8 flex justify-center">
        <form id="contactForm"
                action="{% url 'contact_api' %}"
                method="post"
                class="p-4 shadow-2xl rounded-2xl w-96 border border-gray-300 flex flex-col gap-6">
            {% csrf_token %}

            <!-- Honeypot anti-bots -->
            <div class="hidden">
                <label>Website</label>
                <input name="website" autocomplete="off" tabindex="-1" />
            </div>

            <label for="Name">
                <span class="text-sm font-medium text-gray-700"> Nombre </span>
                <input
                type="text"
                id="Name"
                name="name"
                required
                class="p-2 mt-0.5 w-full rounded border border-gray-300 shadow-sm sm:text-sm"
                placeholder="John Doe"
                autocomplete="name" />
            </label>

            <label for="Email">
                <span class="text-sm font-medium text-gray-700"> Email </span>
                <input
                type="email"
                id="Email"
                name="email"
                required
                class="p-2 mt-0.5 w-full rounded border border-gray-300 shadow-sm sm:text-sm"
                placeholder="nombre@ejemplo.com"
                autocomplete="email" />
            </label>

            <label for="Phone">
                <span class="text-sm font-medium text-gray-700"> Num. Teléfono </span>
                <input
                type="text"
                id="Phone"
                name="phone"
                class="p-2 mt-0.5 w-full rounded border border-gray-300 shadow-sm sm:text-sm"
                placeholder="+34 666 666 666"
                autocomplete="tel" />
            </label>

            <button type="submit"
                class="text-white bg-gradient-to-r from-indigo-600 to-indigo-500 hover:from-indigo-700 hover:to-indigo-600
                    focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-400 dark:focus-visible:ring-indigo-700
                    shadow-sm font-semibold rounded-lg text-base px-6 py-3 text-center">
                Enviar
            </button>

            <p id="formMsg" class="hidden text-sm mt-1"></p>
        </form>
    </div>
    
{% endblock %}
{% block scripts %}
    <script>
        const form = document.getElementById('contactForm');
        const msg  = document.getElementById('formMsg');
        const btn  = form.querySelector('button[type="submit"]');
        const getCSRF = () => document.querySelector('input[name=csrfmiddlewaretoken]').value;

        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // evitamos submit tradicional

            const data = Object.fromEntries(new FormData(form).entries());

            // deshabilita mientras se envía
            btn.disabled = true; btn.classList.add('opacity-70');

            try {
            const res = await fetch("{% url 'contact_api' %}", {
                method: "POST",
                headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCSRF(),
                "Accept": "application/json"
                },
                body: JSON.stringify(data)
            });
            if (!res.ok) throw new Error("bad response");
            form.reset();
            msg.className = "text-green-600 text-sm mt-1";
            msg.textContent = "¡Enviado! Te responderé pronto.";
            } catch (err) {
            msg.className = "text-red-600 text-sm mt-1";
            msg.textContent = "Error al enviar. Inténtalo más tarde.";
            } finally {
            btn.disabled = false; btn.classList.remove('opacity-70');
            }
        });
    </script>
{% endblock %}
